# Shared Types Package

TypeScript types and interfaces used across Rallia mobile and web apps.

## Architecture

The type system is built around **Supabase-generated types as the single source of truth**. All database types are derived from the auto-generated schema, ensuring type safety and consistency with the database.

```
src/
├── supabase.ts      # Auto-generated (DO NOT EDIT MANUALLY)
├── database.ts      # Derived types from supabase.ts
├── ui-types.ts      # UI view models & navigation params
├── constants.ts     # Display labels & domain constants
└── index.ts         # Barrel exports
```

## File Descriptions

### `supabase.ts` (Auto-generated)

**DO NOT EDIT THIS FILE MANUALLY.**

Generated from the Supabase database schema using:

```bash
npm run db:generate-types
```

Contains the `Database` type with all tables, enums, views, and relationships. Regenerate this file whenever the database schema changes.

### `database.ts` (Derived Types)

Types derived from `supabase.ts` for convenient use throughout the app:

- **Row types**: `Profile`, `Player`, `Match`, `Sport`, etc.
- **Insert types**: `ProfileInsert`, `PlayerInsert`, `MatchInsert`, etc.
- **Update types**: `ProfileUpdate`, `PlayerUpdate`, `MatchUpdate`, etc.
- **Enum types**: `GenderType`, `MatchStatus`, `PlayStyle`, `DayOfWeek`, etc.
- **Composite types**: Types with FK relationships like `PlayerWithProfile`, `MatchWithParticipants`

### `ui-types.ts` (UI-Specific Types)

Types that cannot be derived from the database:

- **View models**: `MatchCardDisplay`, `PlayerCardDisplay`, `FacilityCardDisplay`
- **Navigation params**: `RatingProofsScreenParams`, `MatchDetailScreenParams`
- **UI-only enums**: `AccessType`, `ViewMode`, `LoadingState`
- **Form types**: `PreferencesInfo`, `MatchFormData`

### `constants.ts` (Display Labels)

Human-readable labels and mappings for enum values:

- `PLAY_STYLE_LABELS`, `PLAY_ATTRIBUTE_LABELS`
- `SKILL_LEVEL_LABELS`, `MATCH_TYPE_LABELS`
- `DAY_OF_WEEK_LABELS`, `TIME_PERIOD_LABELS`
- `SPORT_DISPLAY_NAMES`, `RATING_SYSTEM_NAMES`

## Usage Examples

### Importing Types

```typescript
// Database types
import { Profile, Player, Match, MatchStatus, GenderType } from '@rallia/shared-types';

// Composite types with FK relationships
import { PlayerWithProfile, MatchWithParticipants } from '@rallia/shared-types';

// Insert/Update types
import { ProfileInsert, ProfileUpdate } from '@rallia/shared-types';

// UI view models
import { MatchCardDisplay, RatingProofsScreenParams } from '@rallia/shared-types';

// Display labels
import { PLAY_STYLE_LABELS, DAY_OF_WEEK_LABELS } from '@rallia/shared-types';

// Database type for Supabase client
import { Database } from '@rallia/shared-types';
```

### Using with Supabase Client

```typescript
import { createClient } from '@supabase/supabase-js';
import { Database } from '@rallia/shared-types';

const supabase = createClient<Database>(SUPABASE_URL, SUPABASE_KEY);

// Now all queries are fully typed
const { data } = await supabase.from('profile').select('*').single();
// data is typed as Profile
```

### Database Types vs UI Types

```typescript
// Database type - matches the actual database schema
import { Match } from '@rallia/shared-types';

const dbMatch: Match = {
  id: '...',
  sport_id: '...',
  match_date: '2024-01-15',
  start_time: '18:00',
  // ... other database fields
};

// UI type - transformed for display purposes
import { MatchCardDisplay } from '@rallia/shared-types';

const displayMatch: MatchCardDisplay = {
  id: '...',
  title: "John's Singles Match",
  date: 'Jan 15',
  time: '6:00 PM - 7:00 PM',
  location: 'Central Park Courts',
  // ... other display fields
};
```

### Using Composite Types

```typescript
import { PlayerWithProfile, MatchWithParticipants } from '@rallia/shared-types';

// Fetch player with profile data
const { data: player } = await supabase.from('player').select('*, profile:profiles(*)').single();

// Type the result
const typedPlayer: PlayerWithProfile = player;
console.log(typedPlayer.profile.full_name);
```

### Using Display Labels

```typescript
import { PlayStyle, PLAY_STYLE_LABELS } from '@rallia/shared-types';

const style: PlayStyle = 'aggressive_baseliner';
const displayLabel = PLAY_STYLE_LABELS[style]; // "Aggressive Baseliner"
```

## Adding New Types

### Database Types

1. Update the database schema in Supabase
2. Run `npm run db:generate-types` to regenerate `supabase.ts`
3. Add derived types to `database.ts` if needed:

```typescript
// Add row type alias
export type NewTable = TableRow<'new_table'>;

// Add insert/update types
export type NewTableInsert = TableInsert<'new_table'>;
export type NewTableUpdate = TableUpdate<'new_table'>;
```

### UI Types

Add new view models or navigation params to `ui-types.ts`:

```typescript
export interface NewScreenParams {
  itemId: string;
  mode: 'view' | 'edit';
}
```

### Display Labels

Add new label mappings to `constants.ts`:

```typescript
export const NEW_ENUM_LABELS: Record<NewEnumType, string> = {
  value_one: 'Value One',
  value_two: 'Value Two',
};
```

## Best Practices

1. **Never edit `supabase.ts` manually** - always regenerate from the database
2. **Use database types for data layer** - services, hooks, API calls
3. **Use UI types for presentation layer** - components, screens
4. **Transform database types to UI types** in service/hook layer before passing to components
5. **Keep composite types in `database.ts`** for commonly used join patterns
6. **Add display labels to `constants.ts`** for any enum that needs human-readable text
